var M=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var i=(r,e,t)=>(M(r,e,"read from private field"),t?t.call(r):e.get(r)),c=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},o=(r,e,t,n)=>(M(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const u of s)if(u.type==="childList")for(const S of u.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&n(S)}).observe(document,{childList:!0,subtree:!0});function t(s){const u={};return s.integrity&&(u.integrity=s.integrity),s.referrerPolicy&&(u.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?u.credentials="include":s.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function n(s){if(s.ep)return;s.ep=!0;const u=t(s);fetch(s.href,u)}})();var H=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)},O=(r,e,t)=>(H(r,e,"read from private field"),t?t.call(r):e.get(r)),N=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},D=(r,e,t,n)=>(H(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);class T{constructor(e){this.value=e}get ok(){return!0}get err(){return!1}expect(){return this.value}expectErr(e){throw new Error(e)}get unwrap(){return this.value}unwrapOr(){return this.value}andThen(e){return e(this.value)}orElse(){return this}map(e){return new T(e(this.value))}mapErr(){return this}get toOptional(){return new L(this.value)}safeUnwrap(){return this.value}}var w;const I=class P{constructor(e){N(this,w,void 0),D(this,w,new Error().stack),this.error=e}get valid(){return!1}get ok(){return!1}get err(){return!0}expect(e){throw new Error(e+`
Original `+O(this,w)+`
Expect Error`)}expectErr(){return this.error}get unwrap(){throw new Error(`Tried to unwrap Error
Original `+O(this,w)+`
Unwrap Error`)}unwrapOr(e){return e}andThen(){return this}orElse(e){return e(this.error)}map(){return this}mapErr(e){return new P(e(this.error))}get toOptional(){return new R}get stack(){return O(this,w)}};w=new WeakMap;let G=I;class L{constructor(e){this.value=e}get valid(){return!0}get some(){return!0}get none(){return!1}expect(){return this.value}get unwrap(){return this.value}unwrapOr(){return this.value}andThen(e){return e(this.value)}orElse(){return this}map(e){return new L(e(this.value))}toResult(){return new T(this.value)}}class R{get valid(){return!1}get some(){return!1}get none(){return!0}expect(e){throw new Error(e)}get unwrap(){throw new Error("Tried to unwrap None")}unwrapOr(e){return e}andThen(){return this}orElse(e){return e()}map(){return this}toResult(e){return new G(e)}}function E(r){return new T(r)}function k(r){return new G(r)}class U{constructor(){this._subscribers=[]}subscribe(e,t){return this._subscribers.push(e),t&&this.then(n=>{e(n.value,n.error)}),e}unsubscribe(e){const t=this._subscribers.indexOf(e);return t!=-1?this._subscribers.splice(t,1):console.warn("Subscriber not found with state",this,e),e}inUse(){return!!this._subscribers.length}hasSubscriber(e){return this._subscribers.includes(e)}_updateSubscribers(e,t){for(let n=0,s=this._subscribers.length;n<s;n++)try{this._subscribers[n](e,t)}catch(u){console.warn("Failed while calling subscribers ",u,this,this._subscribers[n])}}}var m,l,h,a,d,p;class B extends U{constructor(){super(...arguments);c(this,m,0);c(this,l,!1);c(this,h,void 0);c(this,a,[]);c(this,d,0);c(this,p,0)}async then(t){if(i(this,m)>=Date.now())return t(i(this,h));if(i(this,l))return t(await new Promise(n=>{i(this,a).push(n)}));o(this,l,!0),this.debounce>0&&await new Promise(n=>{setTimeout(n,this.debounce)}),o(this,h,await this.singleGet()),o(this,m,Date.now()+this.timeout);for(let n=0;n<i(this,a).length;n++)i(this,a)[n](i(this,h));return o(this,a,[]),o(this,l,!1),t(i(this,h))}updateResource(t,n){o(this,h,n?k(n):E(t)),o(this,m,Date.now()+this.timeout);for(let s=0;s<i(this,a).length;s++)i(this,a)[s](i(this,h));o(this,a,[]),o(this,l,!1),this._updateSubscribers(t,n)}subscribe(t,n){return this._subscribers.length===0?(this._subscribers.push(t),i(this,d)?(clearTimeout(i(this,d)),o(this,d,0)):(o(this,l,!0),this.debounce>0?o(this,p,setTimeout(()=>{this.setupConnection(this),o(this,p,0)},this.debounce)):this.setupConnection(this)),t):super.subscribe(t,n)}unsubscribe(t){return this._subscribers.length===1&&(i(this,p)?(clearTimeout(i(this,p)),o(this,p,0)):this.retention>0?o(this,d,setTimeout(()=>{this.teardownConnection(),o(this,d,0)},this.retention)):this.teardownConnection()),super.unsubscribe(t)}check(t){}limit(t){return t}}m=new WeakMap,l=new WeakMap,h=new WeakMap,a=new WeakMap,d=new WeakMap,p=new WeakMap;class F{constructor(){this.value=0,this.quality=1,setInterval(()=>{this.value++},100)}async fetch(){if(await new Promise(e=>{setTimeout(e,90+Math.random()*20)}),Math.random()+this.quality>1)return this.value;throw"Connection lost"}set connectionQuality(e){this.quality=e}}var f,y;class W extends B{constructor(t){super();c(this,f,void 0);c(this,y,void 0);o(this,f,t)}get debounce(){return 10}get timeout(){return 200}get retention(){return 250}async singleGet(){try{return E(await i(this,f).fetch())}catch(t){return k({code:"CL",reason:t})}}setupConnection(t){o(this,y,setInterval(async()=>{try{t(await i(this,f).fetch())}catch(n){t(void 0,{code:"CL",reason:n})}},500))}teardownConnection(){clearInterval(i(this,y))}write(t){}}f=new WeakMap,y=new WeakMap;let x=new F;window.server=x;let C=new W(x);window.client=C;let b=document.createElement("input");b.type="range";b.min="0";b.max="1";b.step="0.05";b.oninput=()=>{x.quality=Number(b.value)};document.body.appendChild(b);let g=document.createElement("button");g.innerHTML="Single Get";g.onclick=async()=>{(await C).andThen(r=>(g.innerHTML="Single Get "+String(r),E(!1))).orElse(r=>(g.innerHTML="Single Get "+String(r.reason),E(!1)))};document.body.appendChild(g);let v=document.createElement("button");v.innerHTML="Connect";let q;v.onclick=()=>{q=C.subscribe((r,e)=>{e?v.innerHTML="Connect "+String(e.reason):v.innerHTML="Connect "+String(r)})};document.body.appendChild(v);let _=document.createElement("button");_.innerHTML="Disconnect";_.onclick=()=>{C.unsubscribe(q)};document.body.appendChild(_);
